<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VaxSafe Cold Storage</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
overflow:hidden;
font-family:Segoe UI;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
transition:0.4s;
}

#panel{
position:absolute;
top:20px;
left:20px;
width:360px;
background:rgba(0,0,0,0.65);
padding:20px;
border-radius:20px;
backdrop-filter:blur(15px);
box-shadow:0 0 25px rgba(0,255,255,0.4);
}

h1{margin:0;color:#00f5ff;font-size:22px;}
.data{margin-top:10px;font-size:17px;}
#status{margin-top:12px;font-size:19px;font-weight:bold;}
#ai{margin-top:8px;font-size:14px;color:#00ffff;}
canvas{margin-top:15px;background:rgba(255,255,255,0.1);border-radius:10px;}

.flash{
animation:flash 0.7s infinite;
}
@keyframes flash{
50%{background:red;}
}
</style>
</head>
<body>

<div id="panel">
<h1>VaxSafe Cold Storage</h1>

<div class="data">Temperature: <span id="temp">--</span> Â°C</div>
<div class="data">Vaccine Age: <span id="age">--</span> days</div>
<div class="data">Expiry in: <span id="expiry">--</span> days</div>
<div id="status">Checking...</div>
<div id="ai"></div>

<canvas id="graph" width="320" height="150"></canvas>
</div>

<audio id="alarm">
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script>
// ---------- THREE JS ----------
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

const light=new THREE.PointLight(0xffffff,1);
light.position.set(10,10,10);
scene.add(light);

// -------- REAL VACCINE BOX --------
const boxMaterial=new THREE.MeshStandardMaterial({color:0x00aaff});
const boxBase=new THREE.Mesh(new THREE.BoxGeometry(3,2,2),boxMaterial);
scene.add(boxBase);

// Lid
const lid=new THREE.Mesh(new THREE.BoxGeometry(3,0.3,2),boxMaterial);
lid.position.y=1.15;
scene.add(lid);

// Label
const labelMaterial=new THREE.MeshStandardMaterial({color:0xffffff});
const label=new THREE.Mesh(new THREE.BoxGeometry(2,1,0.05),labelMaterial);
label.position.set(0,0,1.03);
scene.add(label);

// Smoke particles
const smokeGeo=new THREE.BufferGeometry();
let particles=150;
let positions=[];
for(let i=0;i<particles;i++){
positions.push((Math.random()-0.5)*2);
positions.push(Math.random()*2);
positions.push((Math.random()-0.5)*2);
}
smokeGeo.setAttribute('position',new THREE.Float32BufferAttribute(positions,3));
const smokeMat=new THREE.PointsMaterial({color:0xaaaaaa,size:0.06});
const smoke=new THREE.Points(smokeGeo,smokeMat);
scene.add(smoke);

camera.position.z=7;

// Animation
function animate(){
requestAnimationFrame(animate);
boxBase.rotation.y+=0.005;
lid.rotation.y+=0.005;
label.rotation.y+=0.005;
smoke.rotation.y+=0.001;
renderer.render(scene,camera);
}
animate();

// -------- GRAPH --------
const ctx=document.getElementById("graph");
const chart=new Chart(ctx,{
type:"line",
data:{labels:[],datasets:[{label:"Temperature",data:[],borderColor:"cyan"}]},
options:{scales:{y:{min:-5,max:15}}}
});

// -------- BLYNK --------
const token="e6GmREw4L6j6PHk-Kh621o6MkQoogzqL";
const pin="V0";
let history=[];

async function getTemp(){
try{
let res=await fetch(`https://blynk.cloud/external/api/get?token=${token}&${pin}`);
let temp=parseFloat(await res.text());
updateUI(temp);
}catch(e){}
}

function updateUI(temp){
document.getElementById("temp").innerText=temp;

history.push(temp);
if(history.length>10)history.shift();

chart.data.labels.push("");
chart.data.datasets[0].data.push(temp);
if(chart.data.labels.length>15){
chart.data.labels.shift();
chart.data.datasets[0].data.shift();
}
chart.update();

const mfg=new Date("2026-02-01");
let today=new Date();
let diff=Math.floor((today-mfg)/(1000*60*60*24));
document.getElementById("age").innerText=diff;
document.getElementById("expiry").innerText=30-diff;

let status=document.getElementById("status");
let ai=document.getElementById("ai");
let alarm=document.getElementById("alarm");

if(temp<-2||temp>8){
status.innerText="CRITICAL ALERT!";
status.style.color="red";
boxMaterial.color.set(0xff0000);
document.body.classList.add("flash");
alarm.play();
lid.rotation.x=-0.5; // lid open
ai.innerText="AI: Temperature unsafe! Cold chain broken.";
}
else if(temp<=0||temp>=7){
status.innerText="Warning Zone";
status.style.color="orange";
boxMaterial.color.set(0xffaa00);
document.body.classList.remove("flash");
alarm.pause();
lid.rotation.x=-0.2;
ai.innerText="AI: Temperature drifting to unsafe range.";
}
else{
status.innerText="Temperature Safe";
status.style.color="lightgreen";
boxMaterial.color.set(0x00aaff);
document.body.classList.remove("flash");
alarm.pause();
lid.rotation.x=0;
ai.innerText="AI: Cold chain stable.";
}
}

setInterval(getTemp,3000);
</script>

</body>
</html>
