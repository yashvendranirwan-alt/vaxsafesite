<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VaxSafe AI ColdChain Pro</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
overflow:hidden;
font-family:Segoe UI;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
transition:0.5s;
}

#panel{
position:absolute;
top:20px;
left:20px;
width:360px;
background:rgba(0,0,0,0.6);
padding:20px;
border-radius:20px;
backdrop-filter:blur(15px);
box-shadow:0 0 25px rgba(0,255,255,0.3);
}

h1{margin:0;font-size:22px;color:#00f5ff;}
.data{margin-top:10px;font-size:18px;}
#status{margin-top:15px;font-size:20px;font-weight:bold;}
#aiMessage{margin-top:10px;font-size:14px;color:#00ffff;}
canvas{margin-top:15px;background:rgba(255,255,255,0.1);border-radius:10px;}

.flash{
animation:flash 0.7s infinite;
}
@keyframes flash{
50%{background:red;}
}
</style>
</head>
<body>

<div id="panel">
<h1>VaxSafe AI ColdChain Pro</h1>

<div class="data">Temperature: <span id="temp">--</span> Â°C</div>
<div class="data">Vaccine Age: <span id="age">--</span></div>
<div class="data">Expiry in: <span id="expiry">--</span> days</div>
<div id="status">Checking...</div>
<div id="aiMessage"></div>

<canvas id="graph" width="320" height="150"></canvas>
</div>

<audio id="alarm">
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script>
// ---------- THREE JS SCENE ----------
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

const light=new THREE.PointLight(0xffffff,1);
light.position.set(10,10,10);
scene.add(light);

// Glass vial
const vialGeo=new THREE.CylinderGeometry(1,1,3,32);
const vialMat=new THREE.MeshPhysicalMaterial({
color:0x00ffff,
transparent:true,
opacity:0.6,
roughness:0,
metalness:0.1
});
const vial=new THREE.Mesh(vialGeo,vialMat);
scene.add(vial);

const capGeo=new THREE.CylinderGeometry(1.1,1.1,0.5,32);
const capMat=new THREE.MeshStandardMaterial({color:0xffffff});
const cap=new THREE.Mesh(capGeo,capMat);
cap.position.y=1.75;
scene.add(cap);

// Storage rack background
for(let i=-5;i<=5;i+=2){
let boxGeo=new THREE.BoxGeometry(0.5,0.5,0.5);
let boxMat=new THREE.MeshStandardMaterial({color:0x0088ff});
let box=new THREE.Mesh(boxGeo,boxMat);
box.position.set(i,-2,-3);
scene.add(box);
}

// Smoke particles
const smokeGeo=new THREE.BufferGeometry();
const smokeCount=200;
let positions=[];
for(let i=0;i<smokeCount;i++){
positions.push((Math.random()-0.5)*2);
positions.push(Math.random()*3);
positions.push((Math.random()-0.5)*2);
}
smokeGeo.setAttribute('position',new THREE.Float32BufferAttribute(positions,3));
const smokeMat=new THREE.PointsMaterial({color:0xaaaaaa,size:0.05});
const smoke=new THREE.Points(smokeGeo,smokeMat);
scene.add(smoke);

camera.position.z=6;

function animate(){
requestAnimationFrame(animate);
vial.rotation.y+=0.01;
cap.rotation.y+=0.01;
smoke.rotation.y+=0.002;
renderer.render(scene,camera);
}
animate();

// ---------- GRAPH ----------
const ctx=document.getElementById('graph');
const chart=new Chart(ctx,{
type:'line',
data:{labels:[],datasets:[{label:'Temperature',data:[],borderColor:'cyan',borderWidth:2}]},
options:{scales:{y:{min:-5,max:15}}}
});

// ---------- BLYNK ----------
const token="e6GmREw4L6j6PHk-Kh621o6MkQoogzqL";
const pin="V0";
let history=[];

async function getTemp(){
try{
let res=await fetch(`https://blynk.cloud/external/api/get?token=${token}&${pin}`);
let temp=parseFloat(await res.text());
updateUI(temp);
}catch(e){}
}

function updateUI(temp){
document.getElementById("temp").innerText=temp;

history.push(temp);
if(history.length>10)history.shift();

chart.data.labels.push("");
chart.data.datasets[0].data.push(temp);
if(chart.data.labels.length>15){
chart.data.labels.shift();
chart.data.datasets[0].data.shift();
}
chart.update();

const manufacture=new Date("2026-02-01");
const today=new Date();
let diff=Math.floor((today-manufacture)/(1000*60*60*24));
document.getElementById("age").innerText=diff;
document.getElementById("expiry").innerText=30-diff;

let status=document.getElementById("status");
let ai=document.getElementById("aiMessage");
let alarm=document.getElementById("alarm");

let avg=history.reduce((a,b)=>a+b,0)/history.length;

if(temp<-2||temp>8){
status.innerText="CRITICAL ALERT!";
status.style.color="red";
vialMat.color.set(0xff0000);
document.body.classList.add("flash");
alarm.play();
ai.innerText="AI: Temperature unsafe! Immediate action required.";
}
else if(temp<=0||temp>=7){
status.innerText="Warning Zone";
status.style.color="orange";
vialMat.color.set(0xffaa00);
document.body.classList.remove("flash");
alarm.pause();
ai.innerText="AI: Temperature drifting toward critical zone.";
}
else{
status.innerText="Temperature Safe";
status.style.color="lightgreen";
vialMat.color.set(0x00ffff);
document.body.classList.remove("flash");
alarm.pause();
ai.innerText="AI: Cold chain stable and maintained.";
}

if(avg>7){
ai.innerText+=" Trend shows rising pattern.";
}
}

setInterval(getTemp,3000);
</script>

</body>
</html>
